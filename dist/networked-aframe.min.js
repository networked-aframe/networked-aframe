(()=>{var t={80:t=>{"use strict";var e=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),n=[],i=function(){var t=n.pop();return t||(t={position:new THREE.Vector3,velocity:new THREE.Vector3,scale:new THREE.Vector3,quaternion:new THREE.Quaternion,time:0}),t},o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.state=0,this.buffer=[],this.bufferTime=1e3*n,this.time=0,this.mode=e,this.originFrame=i(),this.position=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3(1,1,1)}return e(t,[{key:"hermite",value:function(t,e,n,i,o,r){var s=e*e,a=e*e*e,c=2*a-3*s+1,u=-2*a+3*s,l=a-2*s+e,h=a-s;t.copy(n.multiplyScalar(c)),t.add(i.multiplyScalar(u)),t.add(o.multiplyScalar(l)),t.add(r.multiplyScalar(h))}},{key:"lerp",value:function(t,e,n,i){t.lerpVectors(e,n,i)}},{key:"slerp",value:function(t,e,n,i){t.slerpQuaternions(e,n,i)}},{key:"updateOriginFrameToBufferTail",value:function(){var t;t=this.originFrame,n.push(t),this.originFrame=this.buffer.shift()}},{key:"appendBuffer",value:function(t,e,n,o){var r=this.buffer.length>0?this.buffer[this.buffer.length-1]:null;if(r&&r.time===this.time)t&&r.position.copy(t),e&&r.velocity.copy(e),n&&r.quaternion.copy(n),o&&r.scale.copy(o);else{var s=r||this.originFrame,a=i();a.position.copy(t||s.position),a.velocity.copy(e||s.velocity),a.quaternion.copy(n||s.quaternion),a.scale.copy(o||s.scale),a.time=this.time,this.buffer.push(a)}}},{key:"setTarget",value:function(t,e,n,i){this.appendBuffer(t,e,n,i)}},{key:"setPosition",value:function(t,e){this.appendBuffer(t,e,null,null)}},{key:"setQuaternion",value:function(t){this.appendBuffer(null,null,t,null)}},{key:"setScale",value:function(t){this.appendBuffer(null,null,null,t)}},{key:"update",value:function(t){if(0===this.state&&this.buffer.length>0&&(this.updateOriginFrameToBufferTail(),this.position.copy(this.originFrame.position),this.quaternion.copy(this.originFrame.quaternion),this.scale.copy(this.originFrame.scale),this.state=1),1===this.state&&this.buffer.length>0&&this.time>this.bufferTime&&(this.state=2),2===this.state){for(var e=this.time-this.bufferTime;this.buffer.length>0&&e>this.buffer[0].time;)this.buffer.length>1?this.updateOriginFrameToBufferTail():(this.originFrame.position.copy(this.buffer[0].position),this.originFrame.velocity.copy(this.buffer[0].velocity),this.originFrame.quaternion.copy(this.buffer[0].quaternion),this.originFrame.scale.copy(this.buffer[0].scale),this.originFrame.time=this.buffer[0].time,this.buffer[0].time=this.time+t);if(this.buffer.length>0&&this.buffer[0].time>0){var n=this.buffer[0],i=n.time-this.originFrame.time,o=(e-this.originFrame.time)/i;0===this.mode?this.lerp(this.position,this.originFrame.position,n.position,o):1===this.mode&&this.hermite(this.position,o,this.originFrame.position,n.position,this.originFrame.velocity.multiplyScalar(i),n.velocity.multiplyScalar(i)),this.slerp(this.quaternion,this.originFrame.quaternion,n.quaternion,o),this.lerp(this.scale,this.originFrame.scale,n.scale,o)}}0!==this.state&&(this.time+=t)}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getScale",value:function(){return this.scale}}]),t}();t.exports=o},325:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:String(n)}var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.dict={}}var e,i;return e=t,(i=[{key:"addChild",value:function(t,e){this.hasParent(t)||(this.dict[t]=[]),this.dict[t].push(e)}},{key:"getChildren",value:function(t){if(!this.hasParent(t))return[];var e=this.dict[t];return delete this.dict[t],e}},{key:"hasParent",value:function(t){return!!this.dict[t]}}])&&n(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports=o},447:t=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}var n=Array.isArray,i=Object.keys,o=Object.prototype.hasOwnProperty;t.exports=function t(r,s){if(r===s)return!0;if(r&&s&&"object"==e(r)&&"object"==e(s)){var a,c,u,l=n(r),h=n(s);if(l&&h){if((c=r.length)!=s.length)return!1;for(a=c;0!=a--;)if(!t(r[a],s[a]))return!1;return!0}if(l!=h)return!1;var d=r instanceof Date,f=s instanceof Date;if(d!=f)return!1;if(d&&f)return r.getTime()==s.getTime();var p=r instanceof RegExp,m=s instanceof RegExp;if(p!=m)return!1;if(p&&m)return r.toString()==s.toString();var v=i(r);if((c=v.length)!==i(s).length)return!1;for(a=c;0!=a--;)if(!o.call(s,v[a]))return!1;for(a=c;0!=a--;)if(!t(r[u=v[a]],s[u]))return!1;return!0}return r!=r&&s!=s}},520:(t,e,n)=>{var i=n(998),o=n(648),r=n(452),s=n(565),a=n(390),c=n(371),u=n(267),l={app:"",room:"",clientId:""};l.options=i,l.utils=o,l.log=new r,l.schemas=new s,l.version="0.12.0",l.adapters=new u;var h=new a,d=new c(h);l.connection=d,l.entities=h,t.exports=window.NAF=l},367:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:String(n)}var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i;return e=t,(i=[{key:"notImplemented",value:function(t){NAF.log.error("Interface method not implemented:",t)}}])&&n(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports=o},452:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:String(n)}var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.debug=!1}var e,i;return e=t,i=[{key:"setDebug",value:function(t){this.debug=t}},{key:"write",value:function(){this.debug&&console.log.apply(this,arguments)}},{key:"warn",value:function(){console.warn.apply(this,arguments)}},{key:"error",value:function(){console.error.apply(this,arguments)}}],i&&n(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports=o},371:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:String(n)}var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.entities=e,this.setupDefaultDataSubscriptions(),this.connectedClients={},this.activeDataChannels={}}var e,i;return e=t,i=[{key:"setNetworkAdapter",value:function(t){this.adapter=t}},{key:"setupDefaultDataSubscriptions",value:function(){this.dataChannelSubs={},this.dataChannelSubs.u=this.entities.updateEntity.bind(this.entities),this.dataChannelSubs.um=this.entities.updateEntityMulti.bind(this.entities),this.dataChannelSubs.r=this.entities.removeRemoteEntity.bind(this.entities)}},{key:"connect",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];NAF.app=e,NAF.room=n,this.adapter.setServerUrl(t),this.adapter.setApp(e),this.adapter.setRoom(n);var r={audio:i,video:o,datachannel:!0};return this.adapter.setWebRtcOptions(r),this.adapter.setServerConnectListeners(this.connectSuccess.bind(this),this.connectFailure.bind(this)),this.adapter.setDataChannelListeners(this.dataChannelOpen.bind(this),this.dataChannelClosed.bind(this),this.receivedData.bind(this)),this.adapter.setRoomOccupantListener(this.occupantsReceived.bind(this)),this.adapter.connect()}},{key:"onConnect",value:function(t){this.onConnectCallback=t,this.isConnected()?t():document.body.addEventListener("connected",t,!1)}},{key:"connectSuccess",value:function(t){NAF.log.write("Networked-Aframe Client ID:",t),NAF.clientId=t;var e=new CustomEvent("connected",{detail:{clientId:t}});document.body.dispatchEvent(e)}},{key:"connectFailure",value:function(t,e){NAF.log.error(t,"failure to connect")}},{key:"occupantsReceived",value:function(t){var e=Object.assign({},this.connectedClients);this.connectedClients=t,this.checkForDisconnectingClients(e,t),this.checkForConnectingClients(t)}},{key:"checkForDisconnectingClients",value:function(t,e){for(var n in t)e[n]||(NAF.log.write("Closing stream to",n),this.adapter.closeStreamConnection(n))}},{key:"checkForConnectingClients",value:function(t){for(var e in t)this.isNewClient(e)&&this.adapter.shouldStartConnectionTo(t[e])&&(NAF.log.write("Opening datachannel to",e),this.adapter.startStreamConnection(e))}},{key:"getConnectedClients",value:function(){return this.connectedClients}},{key:"isConnected",value:function(){return!!NAF.clientId}},{key:"isMineAndConnected",value:function(t){return this.isConnected()&&NAF.clientId===t}},{key:"isNewClient",value:function(t){return!this.isConnectedTo(t)}},{key:"isConnectedTo",value:function(t){return this.adapter.getConnectStatus(t)===NAF.adapters.IS_CONNECTED}},{key:"dataChannelOpen",value:function(t){NAF.log.write("Opened data channel from "+t),this.activeDataChannels[t]=!0,this.entities.completeSync(t,!0);var e=new CustomEvent("clientConnected",{detail:{clientId:t}});document.body.dispatchEvent(e)}},{key:"dataChannelClosed",value:function(t){NAF.log.write("Closed data channel from "+t),this.activeDataChannels[t]=!1,this.entities.removeEntitiesOfClient(t);var e=new CustomEvent("clientDisconnected",{detail:{clientId:t}});document.body.dispatchEvent(e)}},{key:"hasActiveDataChannel",value:function(t){return!!this.activeDataChannels[t]}},{key:"broadcastData",value:function(t,e){this.adapter.broadcastData(t,e)}},{key:"broadcastDataGuaranteed",value:function(t,e){this.adapter.broadcastDataGuaranteed(t,e)}},{key:"sendData",value:function(t,e,n,i){this.hasActiveDataChannel(t)&&(i?this.adapter.sendDataGuaranteed(t,e,n):this.adapter.sendData(t,e,n))}},{key:"sendDataGuaranteed",value:function(t,e,n){this.sendData(t,e,n,!0)}},{key:"subscribeToDataChannel",value:function(t,e){this.isReservedDataType(t)?NAF.log.error("NetworkConnection@subscribeToDataChannel: "+t+" is a reserved dataType. Choose another"):this.dataChannelSubs[t]=e}},{key:"unsubscribeToDataChannel",value:function(t){this.isReservedDataType(t)?NAF.log.error("NetworkConnection@unsubscribeToDataChannel: "+t+" is a reserved dataType. Choose another"):delete this.dataChannelSubs[t]}},{key:"isReservedDataType",value:function(t){return"u"==t||"r"==t}},{key:"receivedData",value:function(t,e,n,i){this.dataChannelSubs[e]?this.dataChannelSubs[e](t,e,n,i):NAF.log.write("NetworkConnection@receivedData: "+e+" has not been subscribed to yet. Call subscribeToDataChannel()")}},{key:"getServerTime",value:function(){return this.adapter.getServerTime()}},{key:"disconnect",value:function(){this.entities.removeRemoteEntities(),this.adapter&&this.adapter.disconnect(),NAF.app="",NAF.room="",NAF.clientId="",this.connectedClients={},this.activeDataChannels={},this.adapter=null,this.setupDefaultDataSubscriptions(),document.body.removeEventListener("connected",this.onConnectCallback)}}],i&&n(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports=o},390:(t,e,n)=>{function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i)}}function r(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:String(e)}var s=n(325),a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.entities={},this.childCache=new s,this.onRemoteEntityCreatedEvent=new Event("remoteEntityCreated"),this._persistentFirstSyncs={}}var e,n;return e=t,(n=[{key:"registerEntity",value:function(t,e){this.entities[t]=e}},{key:"createRemoteEntity",value:function(t){NAF.log.write("Creating remote entity",t);var e=t.networkId,n=NAF.schemas.getCachedTemplate(t.template);return this.initPosition(n,t.components),this.initRotation(n,t.components),this.addNetworkComponent(n,t),this.registerEntity(e,n),n}},{key:"initPosition",value:function(t,e){if(e.position){var n=e.position;t.setAttribute("position",n)}}},{key:"initRotation",value:function(t,e){if(e.rotation){var n=e.rotation;t.setAttribute("rotation",n)}}},{key:"addNetworkComponent",value:function(t,e){var n={template:e.template,creator:e.creator,owner:e.owner,networkId:e.networkId,persistent:e.persistent};t.setAttribute("networked",n),t.firstUpdateData=e}},{key:"updateEntityMulti",value:function(t,e,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource)for(var o=0,r=n.d.length;o<r;o++)this.updateEntity(t,"u",n.d[o],i)}},{key:"updateEntity",value:function(t,e,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource){var o=n.networkId;this.hasEntity(o)?this.entities[o].components.networked.networkUpdate(n):n.isFirstSync&&!1!==NAF.connection.activeDataChannels[n.owner]&&(NAF.options.firstSyncSource&&i!==NAF.options.firstSyncSource?NAF.log.write("Ignoring first sync from disallowed source",i):n.persistent?this._persistentFirstSyncs[o]=n:this.receiveFirstUpdateFromEntity(n))}}},{key:"receiveFirstUpdateFromEntity",value:function(t){var e=t.parent,n=t.networkId;if(e&&!this.hasEntity(e))this.childCache.addChild(e,t);else{var i=this.createRemoteEntity(t);this.createAndAppendChildren(n,i),this.addEntityToPage(i,e)}}},{key:"createAndAppendChildren",value:function(t,e){for(var n=this.childCache.getChildren(t),i=0;i<n.length;i++){var o=n[i],r=o.networkId;if(this.hasEntity(r))NAF.log.warn("Tried to instantiate entity multiple times",r,o,"Existing entity:",this.getEntity(r));else{var s=this.createRemoteEntity(o);this.createAndAppendChildren(r,s),e.appendChild(s)}}}},{key:"addEntityToPage",value:function(t,e){this.hasEntity(e)?this.addEntityToParent(t,e):this.addEntityToSceneRoot(t)}},{key:"addEntityToParent",value:function(t,e){this.entities[e].appendChild(t)}},{key:"addEntityToSceneRoot",value:function(t){document.querySelector("a-scene").appendChild(t)}},{key:"completeSync",value:function(t,e){for(var n in this.entities)this.entities[n]&&this.entities[n].components.networked.syncAll(t,e)}},{key:"removeRemoteEntity",value:function(t,e,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource){var o=n.networkId;return this.removeEntity(o)}}},{key:"removeEntitiesOfClient",value:function(t){var e=[];for(var n in this.entities){var i=this.entities[n],o=NAF.utils.getCreator(i),r=NAF.utils.getNetworkOwner(i);if(o===t||!o&&r===t){var s=this.entities[n].getAttribute("networked");s&&s.persistent?NAF.utils.takeOwnership(i):e.push(this.removeEntity(n))}}return e}},{key:"removeEntity",value:function(t){if(this.forgetPersistentFirstSync(t),this.hasEntity(t)){var e=this.entities[t];return this.forgetEntity(t),e.parentNode.removeChild(e),e}return NAF.log.error("Tried to remove entity I don't have."),null}},{key:"forgetEntity",value:function(t){delete this.entities[t],this.forgetPersistentFirstSync(t)}},{key:"getPersistentFirstSync",value:function(t){return this._persistentFirstSyncs[t]}},{key:"forgetPersistentFirstSync",value:function(t){delete this._persistentFirstSyncs[t]}},{key:"getEntity",value:function(t){return this.entities[t]?this.entities[t]:null}},{key:"hasEntity",value:function(t){return!!this.entities[t]}},{key:"removeRemoteEntities",value:function(){for(var t in this.childCache=new s,this.entities)this.entities[t].getAttribute("networked").owner!=NAF.clientId&&this.removeEntity(t)}}])&&o(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports=a},565:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:String(n)}var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.schemaDict={},this.templateCache={}}var e,i;return e=t,(i=[{key:"createDefaultSchema",value:function(t){return{template:t,components:[{component:"position",requiresNetworkUpdate:NAF.utils.vectorRequiresUpdate(.001)},{component:"rotation",requiresNetworkUpdate:NAF.utils.vectorRequiresUpdate(.5)}]}}},{key:"add",value:function(t){if(this.validateSchema(t)){this.schemaDict[t.template]=t;var e=document.querySelector(t.template);if(!e)return void NAF.log.error("Template el not found for ".concat(t.template,", make sure NAF.schemas.add is called after <a-scene> is defined."));if(!this.validateTemplate(t,e))return;this.templateCache[t.template]=document.importNode(e.content,!0)}else NAF.log.error("Schema not valid: ",t),NAF.log.error("See https://github.com/networked-aframe/networked-aframe#syncing-custom-components")}},{key:"getCachedTemplate",value:function(t){return this.templateIsCached(t)||(this.templateExistsInScene(t)?this.add(this.createDefaultSchema(t)):NAF.log.error("Template el for ".concat(t," is not in the scene, add the template to <a-assets> and register with NAF.schemas.add."))),this.templateCache[t].firstElementChild.cloneNode(!0)}},{key:"templateIsCached",value:function(t){return!!this.templateCache[t]}},{key:"getComponents",value:function(t){var e=["position","rotation"];return this.hasTemplate(t)&&(e=this.schemaDict[t].components),e}},{key:"hasTemplate",value:function(t){return!!this.schemaDict[t]}},{key:"templateExistsInScene",value:function(t){var e=document.querySelector(t);return e&&this.isTemplateTag(e)}},{key:"validateSchema",value:function(t){return!(!t.template||!t.components)}},{key:"validateTemplate",value:function(t,e){return this.isTemplateTag(e)?!!this.templateHasOneOrZeroChildren(e)||(NAF.log.error("Template for ".concat(t.template," has more than one child. Templates must have one direct child element, no more. Template found:"),e),!1):(NAF.log.error("Template for ".concat(t.template," is not a <template> tag. Instead found: ").concat(e.tagName)),!1)}},{key:"isTemplateTag",value:function(t){return"template"===t.tagName.toLowerCase()}},{key:"templateHasOneOrZeroChildren",value:function(t){return t.content.childElementCount<2}},{key:"remove",value:function(t){delete this.schemaDict[t]}},{key:"clear",value:function(){this.schemaDict={}}}])&&n(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports=o},267:(t,e,n)=>{function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i)}}function r(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:String(e)}var s=n(207),a=n(658),c=n(941),u=n(723),l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.adapters={wseasyrtc:s,easyrtc:a,socketio:u,webrtc:c},this.IS_CONNECTED=t.IS_CONNECTED,this.CONNECTING=t.CONNECTING,this.NOT_CONNECTED=t.NOT_CONNECTED}var e,n;return e=t,(n=[{key:"register",value:function(t,e){this.adapters[t]=e}},{key:"make",value:function(t){var e=t.toLowerCase();if(this.adapters[e])return new(0,this.adapters[e]);throw new Error("Adapter: "+t+" not registered. Please use NAF.adapters.register() to register this adapter.")}}])&&o(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();l.IS_CONNECTED="IS_CONNECTED",l.CONNECTING="CONNECTING",l.NOT_CONNECTED="NOT_CONNECTED",t.exports=l},658:(t,e,n)=>{function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,s(i.key),i)}}function s(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:String(e)}function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}var u=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(h,t);var e,n,s,u,l=(s=h,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=c(s);if(u){var n=c(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function h(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(e=l.call(this)).easyrtc=t||window.easyrtc,e.app="default",e.room="default",e.mediaStreams={},e.remoteClients={},e.pendingMediaRequests=new Map,e.serverTimeRequests=0,e.timeOffsets=[],e.avgTimeOffset=0,e.easyrtc.setPeerOpenListener((function(t){var n=e.easyrtc.getPeerConnectionByUserId(t);e.remoteClients[t]=n})),e.easyrtc.setPeerClosedListener((function(t){delete e.remoteClients[t];var n=e.pendingMediaRequests.get(t);n&&(Object.keys(n).forEach((function(t){n[t].reject("The user disconnected before the media stream was resolved.")})),e.pendingMediaRequests.delete(t))})),e}return e=h,n=[{key:"setServerUrl",value:function(t){this.easyrtc.setSocketUrl(t)}},{key:"setApp",value:function(t){this.app=t}},{key:"setRoom",value:function(t){this.room=t,this.easyrtc.joinRoom(t,null)}},{key:"setWebRtcOptions",value:function(t){this.easyrtc.enableDataChannels(t.datachannel),this.easyrtc.enableVideo(t.video),this.easyrtc.enableAudio(t.audio),this.easyrtc.enableVideoReceive(!0),this.easyrtc.enableAudioReceive(!0)}},{key:"setServerConnectListeners",value:function(t,e){this.connectSuccess=t,this.connectFailure=e}},{key:"setRoomOccupantListener",value:function(t){this.easyrtc.setRoomOccupantListener((function(e,n,i){t(n)}))}},{key:"setDataChannelListeners",value:function(t,e,n){this.easyrtc.setDataChannelOpenListener(t),this.easyrtc.setDataChannelCloseListener(e),this.easyrtc.setPeerListener(n)}},{key:"updateTimeOffset",value:function(){var t=this,e=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then((function(n){var i=new Date(n.headers.get("Date")).getTime()+500,o=Date.now(),r=i+(o-e)/2-o;t.serverTimeRequests++,t.serverTimeRequests<=10?t.timeOffsets.push(r):t.timeOffsets[t.serverTimeRequests%10]=r,t.avgTimeOffset=t.timeOffsets.reduce((function(t,e){return t+e}),0)/t.timeOffsets.length,t.serverTimeRequests>10?setTimeout((function(){return t.updateTimeOffset()}),3e5):t.updateTimeOffset()}))}},{key:"connect",value:function(){var t=this;Promise.all([this.updateTimeOffset(),new Promise((function(e,n){t._connect(e,n)}))]).then((function(e){var n,i,r=(i=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,r,s,a=[],c=!0,u=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=r.call(n)).done)&&(a.push(i.value),a.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}}(n,i)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(n,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=(r[0],r[1]);t._myRoomJoinTime=t._getRoomJoinTime(s),t.connectSuccess(s)})).catch(this.connectFailure)}},{key:"shouldStartConnectionTo",value:function(t){return this._myRoomJoinTime<=t.roomJoinTime}},{key:"startStreamConnection",value:function(t){this.easyrtc.call(t,(function(t,e){"datachannel"===e&&NAF.log.write("Successfully started datachannel to ",t)}),(function(t,e){NAF.log.error(t,e)}),(function(t){}))}},{key:"closeStreamConnection",value:function(t){this.easyrtc.hangup(t)}},{key:"sendData",value:function(t,e,n){this.easyrtc.sendData(t,e,n)}},{key:"sendDataGuaranteed",value:function(t,e,n){this.easyrtc.sendDataWS(t,e,n)}},{key:"broadcastData",value:function(t,e){var n=this.easyrtc.getRoomOccupantsAsMap(this.room);for(var i in n)n[i]&&i!==this.easyrtc.myEasyrtcid&&this.easyrtc.sendData(i,t,e)}},{key:"broadcastDataGuaranteed",value:function(t,e){var n={targetRoom:this.room};this.easyrtc.sendDataWS(n,t,e)}},{key:"getConnectStatus",value:function(t){var e=this.easyrtc.getConnectStatus(t);return e==this.easyrtc.IS_CONNECTED?NAF.adapters.IS_CONNECTED:e==this.easyrtc.NOT_CONNECTED?NAF.adapters.NOT_CONNECTED:NAF.adapters.CONNECTING}},{key:"getMediaStream",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio";if(this.mediaStreams[t]&&this.mediaStreams[t][e])return NAF.log.write("Already had ".concat(e," for ").concat(t)),Promise.resolve(this.mediaStreams[t][e]);if(NAF.log.write("Waiting on ".concat(e," for ").concat(t)),!this.pendingMediaRequests.has(t)){var n={},i=new Promise((function(t,e){n.audio={resolve:t,reject:e}})).catch((function(e){return NAF.log.warn("".concat(t," getMediaStream Audio Error"),e)}));n.audio.promise=i;var o=new Promise((function(t,e){n.video={resolve:t,reject:e}})).catch((function(e){return NAF.log.warn("".concat(t," getMediaStream Video Error"),e)}));n.video.promise=o,this.pendingMediaRequests.set(t,n)}var r=this.pendingMediaRequests.get(t);if(!r[e]){var s=new Promise((function(t,n){r[e]={resolve:t,reject:n}})).catch((function(n){return NAF.log.warn("".concat(t,' getMediaStream "').concat(e,'" Error'),n)}));r[e].promise=s}return this.pendingMediaRequests.get(t)[e].promise}},{key:"setMediaStream",value:function(t,e,n){var i=this.pendingMediaRequests.get(t),o=this.mediaStreams[t]=this.mediaStreams[t]||{};if("default"===n){var r=e.getAudioTracks();if(r.length>0){var s=new MediaStream;try{r.forEach((function(t){return s.addTrack(t)})),o.audio=s}catch(e){NAF.log.warn("".concat(t,' setMediaStream "audio" alias Error'),e)}i&&i.audio.resolve(s)}var a=e.getVideoTracks();if(a.length>0){var c=new MediaStream;try{a.forEach((function(t){return c.addTrack(t)})),o.video=c}catch(e){NAF.log.warn("".concat(t,' setMediaStream "video" alias Error'),e)}i&&i.video.resolve(c)}}else o[n]=e,i&&i[n]&&(i[n].resolve(e),delete i[n])}},{key:"addLocalMediaStream",value:function(t,e){var n=this.easyrtc;e=e||t.id,this.setMediaStream("local",t,e),n.register3rdPartyLocalMediaStream(t,e),Object.keys(this.remoteClients).forEach((function(t){n.getConnectStatus(t)!==n.NOT_CONNECTED&&n.addStreamToCall(t,e)}))}},{key:"removeLocalMediaStream",value:function(t){this.easyrtc.closeLocalMediaStream(t),delete this.mediaStreams.local[t]}},{key:"enableMicrophone",value:function(t){this.easyrtc.enableMicrophone(t)}},{key:"enableCamera",value:function(t){this.easyrtc.enableCamera(t)}},{key:"disconnect",value:function(){this.easyrtc.disconnect()}},{key:"_connect",value:function(t,e){var n=this;this.easyrtc.setStreamAcceptor(this.setMediaStream.bind(this)),this.easyrtc.setOnStreamClosed((function(t,e,i){"default"===i?(delete n.mediaStreams[t].audio,delete n.mediaStreams[t].video):delete n.mediaStreams[t][i],0===Object.keys(n.mediaStreams[t]).length&&delete n.mediaStreams[t]})),n.easyrtc.audioEnabled||n.easyrtc.videoEnabled?navigator.mediaDevices.getUserMedia({video:n.easyrtc.videoEnabled,audio:n.easyrtc.audioEnabled}).then((function(i){n.addLocalMediaStream(i,"default"),n.easyrtc.connect(n.app,t,e)}),(function(t,e){NAF.log.error(t,e)})):n.easyrtc.connect(n.app,t,e)}},{key:"_getRoomJoinTime",value:function(t){var e=NAF.room;return this.easyrtc.getRoomOccupantsAsMap(e)[t].roomJoinTime}},{key:"getServerTime",value:function(){return Date.now()+this.avgTimeOffset}}],n&&r(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),h}(n(49));t.exports=u},49:(t,e,n)=>{function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i)}}function r(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:String(e)}function s(t,e){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},s(t,e)}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}var c=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(l,t);var e,n,r,c,u=(r=l,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=a(r);if(c){var n=a(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function l(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),u.apply(this,arguments)}return e=l,(n=[{key:"setServerUrl",value:function(t){this.notImplemented("setServerUrl")}},{key:"setApp",value:function(t){this.notImplemented("setApp")}},{key:"setRoom",value:function(t){this.notImplemented("setRoom")}},{key:"setWebRtcOptions",value:function(t){this.notImplemented("setWebRtcOptions")}},{key:"setServerConnectListeners",value:function(t,e){this.notImplemented("setServerConnectListeners")}},{key:"setRoomOccupantListener",value:function(t){this.notImplemented("setRoomOccupantListener")}},{key:"setDataChannelListeners",value:function(t,e,n){this.notImplemented("setDataChannelListeners")}},{key:"connect",value:function(){this.notImplemented("connect")}},{key:"shouldStartConnectionTo",value:function(t){this.notImplemented("shouldStartConnectionTo")}},{key:"startStreamConnection",value:function(t){this.notImplemented("startStreamConnection")}},{key:"closeStreamConnection",value:function(t){this.notImplemented("closeStreamConnection")}},{key:"getConnectStatus",value:function(t){this.notImplemented("getConnectStatus")}},{key:"getMediaStream",value:function(t){return Promise.reject("Interface method not implemented: getMediaStream")}},{key:"getServerTime",value:function(){this.notImplemented("getServerTime")}},{key:"sendData",value:function(t,e,n){this.notImplemented("sendData")}},{key:"sendDataGuaranteed",value:function(t,e,n){this.notImplemented("sendDataGuaranteed")}},{key:"broadcastData",value:function(t,e){this.notImplemented("broadcastData")}},{key:"broadcastDataGuaranteed",value:function(t,e){this.notImplemented("broadcastDataGuaranteed")}},{key:"disconnect",value:function(){this.notImplemented("disconnect")}}])&&o(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),l}(n(367));t.exports=c},207:(t,e,n)=>{function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,s(i.key),i)}}function s(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:String(e)}function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}var u=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(h,t);var e,n,s,u,l=(s=h,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=c(s);if(u){var n=c(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function h(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(e=l.call(this)).easyrtc=t||window.easyrtc,e.app="default",e.room="default",e.connectedClients=[],e.serverTimeRequests=0,e.timeOffsets=[],e.avgTimeOffset=0,e}return e=h,(n=[{key:"setServerUrl",value:function(t){this.serverUrl=t,this.easyrtc.setSocketUrl(t)}},{key:"setApp",value:function(t){this.app=t}},{key:"setRoom",value:function(t){this.room=t,this.easyrtc.joinRoom(t,null)}},{key:"setWebRtcOptions",value:function(t){}},{key:"setServerConnectListeners",value:function(t,e){this.connectSuccess=t,this.connectFailure=e}},{key:"setRoomOccupantListener",value:function(t){this.easyrtc.setRoomOccupantListener((function(e,n,i){t(n)}))}},{key:"setDataChannelListeners",value:function(t,e,n){this.openListener=t,this.closedListener=e,this.easyrtc.setPeerListener(n)}},{key:"updateTimeOffset",value:function(){var t=this,e=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then((function(n){var i=new Date(n.headers.get("Date")).getTime()+500,o=Date.now(),r=i+(o-e)/2-o;t.serverTimeRequests++,t.serverTimeRequests<=10?t.timeOffsets.push(r):t.timeOffsets[t.serverTimeRequests%10]=r,t.avgTimeOffset=t.timeOffsets.reduce((function(t,e){return t+e}),0)/t.timeOffsets.length,t.serverTimeRequests>10?setTimeout((function(){return t.updateTimeOffset()}),3e5):t.updateTimeOffset()}))}},{key:"connect",value:function(){var t=this;Promise.all([this.updateTimeOffset(),new Promise((function(e,n){t.easyrtc.connect(t.app,e,n)}))]).then((function(e){var n,i,r=(i=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,r,s,a=[],c=!0,u=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=r.call(n)).done)&&(a.push(i.value),a.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}}(n,i)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(n,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=(r[0],r[1]);t.connectSuccess(s)})).catch(this.connectFailure)}},{key:"shouldStartConnectionTo",value:function(t){return!0}},{key:"startStreamConnection",value:function(t){this.connectedClients.push(t),this.openListener(t)}},{key:"closeStreamConnection",value:function(t){var e=this.connectedClients.indexOf(t);e>-1&&this.connectedClients.splice(e,1),this.closedListener(t)}},{key:"sendData",value:function(t,e,n){this.easyrtc.sendDataWS(t,e,n)}},{key:"sendDataGuaranteed",value:function(t,e,n){this.sendData(t,e,n)}},{key:"broadcastData",value:function(t,e){var n={targetRoom:this.room};this.easyrtc.sendDataWS(n,t,e)}},{key:"broadcastDataGuaranteed",value:function(t,e){this.broadcastData(t,e)}},{key:"getConnectStatus",value:function(t){return-1!=this.connectedClients.indexOf(t)?NAF.adapters.IS_CONNECTED:NAF.adapters.NOT_CONNECTED}},{key:"getServerTime",value:function(){return Date.now()+this.avgTimeOffset}},{key:"disconnect",value:function(){this.easyrtc.disconnect()}}])&&r(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),h}(n(49));t.exports=u},723:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:String(n)}var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===io&&console.warn("It looks like socket.io has not been loaded before SocketioAdapter. Please do that."),this.app="default",this.room="default",this.occupantListener=null,this.myRoomJoinTime=null,this.myId=null,this.occupants={},this.connectedClients=[],this.serverTimeRequests=0,this.timeOffsets=[],this.avgTimeOffset=0}var e,i;return e=t,(i=[{key:"setServerUrl",value:function(t){this.wsUrl=t}},{key:"setApp",value:function(t){this.app=t}},{key:"setRoom",value:function(t){this.room=t}},{key:"setWebRtcOptions",value:function(t){}},{key:"setServerConnectListeners",value:function(t,e){this.connectSuccess=t,this.connectFailure=e}},{key:"setRoomOccupantListener",value:function(t){this.occupantListener=t}},{key:"setDataChannelListeners",value:function(t,e,n){this.openListener=t,this.closedListener=e,this.messageListener=n}},{key:"connect",value:function(){var t=this;this.updateTimeOffset().then((function(){t.wsUrl&&"/"!==t.wsUrl||("https:"===location.protocol?t.wsUrl="wss://"+location.host:t.wsUrl="ws://"+location.host),NAF.log.write("Attempting to connect to socket.io");var e=t.socket=io(t.wsUrl);function n(e){var n=e.from,i=e.type,o=e.data;t.messageListener(n,i,o)}e.on("connect",(function(){NAF.log.write("User connected",e.id),t.myId=e.id,t.joinRoom()})),e.on("connectSuccess",(function(e){var n=e.joinedTime;t.myRoomJoinTime=n,NAF.log.write("Successfully joined room",t.room,"at server time",n),t.connectSuccess(t.myId)})),e.on("error",(function(e){console.error("Socket connection failure",e),t.connectFailure()})),e.on("occupantsChanged",(function(e){var n=e.occupants;NAF.log.write("occupants changed",e),t.receivedOccupants(n)})),e.on("send",n),e.on("broadcast",n)}))}},{key:"joinRoom",value:function(){NAF.log.write("Joining room",this.room),this.socket.emit("joinRoom",{room:this.room})}},{key:"receivedOccupants",value:function(t){delete t[this.myId],this.occupants=t,this.occupantListener(t)}},{key:"shouldStartConnectionTo",value:function(t){return!0}},{key:"startStreamConnection",value:function(t){this.connectedClients.push(t),this.openListener(t)}},{key:"closeStreamConnection",value:function(t){this.connectedClients=this.connectedClients.filter((function(e){return e!=t})),this.closedListener(t)}},{key:"getConnectStatus",value:function(t){return-1!=this.connectedClients.indexOf(t)?NAF.adapters.IS_CONNECTED:NAF.adapters.NOT_CONNECTED}},{key:"sendData",value:function(t,e,n){this.sendDataGuaranteed(t,e,n)}},{key:"sendDataGuaranteed",value:function(t,e,n){var i={from:this.myId,to:t,type:e,data:n,sending:!0};this.socket?this.socket.emit("send",i):NAF.log.warn("SocketIO socket not created yet")}},{key:"broadcastData",value:function(t,e){this.broadcastDataGuaranteed(t,e)}},{key:"broadcastDataGuaranteed",value:function(t,e){var n={from:this.myId,type:t,data:e,broadcasting:!0};this.socket?this.socket.emit("broadcast",n):NAF.log.warn("SocketIO socket not created yet")}},{key:"getMediaStream",value:function(t){}},{key:"updateTimeOffset",value:function(){var t=this,e=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then((function(n){var i=new Date(n.headers.get("Date")).getTime()+500,o=Date.now(),r=i+(o-e)/2-o;t.serverTimeRequests++,t.serverTimeRequests<=10?t.timeOffsets.push(r):t.timeOffsets[t.serverTimeRequests%10]=r,t.avgTimeOffset=t.timeOffsets.reduce((function(t,e){return t+e}),0)/t.timeOffsets.length,t.serverTimeRequests>10?setTimeout((function(){return t.updateTimeOffset()}),3e5):t.updateTimeOffset()}))}},{key:"getServerTime",value:function(){return(new Date).getTime()+this.avgTimeOffset}},{key:"disconnect",value:function(){this.socket.disconnect()}}])&&n(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports=o},941:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:String(n)}var s=function(){function t(e,i,o){n(this,t),this.localId=e,this.remoteId=i,this.sendSignalFunc=o,this.open=!1,this.channelLabel="networked-aframe-channel",this.pc=this.createPeerConnection(),this.channel=null}return o(t,[{key:"setDatachannelListeners",value:function(t,e,n,i){this.openListener=t,this.closedListener=e,this.messageListener=n,this.trackListener=i}},{key:"offer",value:function(t){var e=this;this.setupChannel(this.pc.createDataChannel(this.channelLabel,{reliable:!1})),t.sendAudio&&t.localAudioStream.getTracks().forEach((function(n){return e.pc.addTrack(n,t.localAudioStream)})),this.pc.createOffer((function(t){e.handleSessionDescription(t)}),(function(t){NAF.log.error("WebRtcPeer.offer: "+t)}),{offerToReceiveAudio:!0,offerToReceiveVideo:!1})}},{key:"handleSignal",value:function(t){if(this.localId===t.to&&this.remoteId===t.from)switch(t.type){case"offer":this.handleOffer(t);break;case"answer":this.handleAnswer(t);break;case"candidate":this.handleCandidate(t);break;default:NAF.log.error("WebRtcPeer.handleSignal: Unknown signal type "+t.type)}}},{key:"send",value:function(t,e){null!==this.channel&&"open"===this.channel.readyState&&this.channel.send(JSON.stringify({type:t,data:e}))}},{key:"getStatus",value:function(){if(null===this.channel)return t.NOT_CONNECTED;switch(this.channel.readyState){case"open":return t.IS_CONNECTED;case"connecting":return t.CONNECTING;default:return t.NOT_CONNECTED}}},{key:"createPeerConnection",value:function(){var e=this,n=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection;if(void 0===n)throw new Error("WebRtcPeer.createPeerConnection: This browser does not seem to support WebRTC.");var i=new n({iceServers:t.ICE_SERVERS});return i.onicecandidate=function(t){t.candidate&&e.sendSignalFunc({from:e.localId,to:e.remoteId,type:"candidate",sdpMLineIndex:t.candidate.sdpMLineIndex,candidate:t.candidate.candidate})},i.oniceconnectionstatechange=function(){e.open&&"disconnected"===i.iceConnectionState&&(e.open=!1,e.closedListener(e.remoteId))},i.ontrack=function(t){e.trackListener(e.remoteId,t.streams[0])},i}},{key:"setupChannel",value:function(t){var e=this;this.channel=t,this.channel.onmessage=function(t){var n=JSON.parse(t.data);e.messageListener(e.remoteId,n.type,n.data)},this.channel.onopen=function(t){e.open=!0,e.openListener(e.remoteId)},this.channel.onclose=function(t){e.open&&(e.open=!1,e.closedListener(e.remoteId))},this.channel.onerror=function(t){NAF.log.error("WebRtcPeer.channel.onerror: "+t)}}},{key:"handleOffer",value:function(t){var e=this;this.pc.ondatachannel=function(t){e.setupChannel(t.channel)},this.setRemoteDescription(t),this.pc.createAnswer((function(t){e.handleSessionDescription(t)}),(function(t){NAF.log.error("WebRtcPeer.handleOffer: "+t)}))}},{key:"handleAnswer",value:function(t){this.setRemoteDescription(t)}},{key:"handleCandidate",value:function(t){var e=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate;this.pc.addIceCandidate(new e(t),(function(){}),(function(t){NAF.log.error("WebRtcPeer.handleCandidate: "+t)}))}},{key:"handleSessionDescription",value:function(t){this.pc.setLocalDescription(t,(function(){}),(function(t){NAF.log.error("WebRtcPeer.handleSessionDescription: "+t)})),this.sendSignalFunc({from:this.localId,to:this.remoteId,type:t.type,sdp:t.sdp})}},{key:"setRemoteDescription",value:function(t){var e=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription||window.msRTCSessionDescription;this.pc.setRemoteDescription(new e(t),(function(){}),(function(t){NAF.log.error("WebRtcPeer.setRemoteDescription: "+t)}))}},{key:"close",value:function(){this.pc&&this.pc.close()}}]),t}();s.IS_CONNECTED="IS_CONNECTED",s.CONNECTING="CONNECTING",s.NOT_CONNECTED="NOT_CONNECTED",s.ICE_SERVERS=[{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}];var a=function(){function t(){n(this,t),void 0===io&&console.warn("It looks like socket.io has not been loaded before WebrtcAdapter. Please do that."),this.app="default",this.room="default",this.occupantListener=null,this.myRoomJoinTime=null,this.myId=null,this.peers={},this.occupants={},this.audioStreams={},this.pendingAudioRequest={},this.serverTimeRequests=0,this.timeOffsets=[],this.avgTimeOffset=0}return o(t,[{key:"setServerUrl",value:function(t){this.wsUrl=t}},{key:"setApp",value:function(t){this.app=t}},{key:"setRoom",value:function(t){this.room=t}},{key:"setWebRtcOptions",value:function(t){!1===t.datachannel&&NAF.log.error("WebrtcAdapter.setWebRtcOptions: datachannel must be true."),!0===t.audio&&(this.sendAudio=!0),!0===t.video&&NAF.log.warn("WebrtcAdapter does not support video yet.")}},{key:"setServerConnectListeners",value:function(t,e){this.connectSuccess=t,this.connectFailure=e}},{key:"setRoomOccupantListener",value:function(t){this.occupantListener=t}},{key:"setDataChannelListeners",value:function(t,e,n){this.openListener=t,this.closedListener=e,this.messageListener=n}},{key:"connect",value:function(){var t=this;this.updateTimeOffset().then((function(){t.wsUrl&&"/"!==t.wsUrl||("https:"===location.protocol?t.wsUrl="wss://"+location.host:t.wsUrl="ws://"+location.host),NAF.log.write("Attempting to connect to socket.io");var e=t.socket=io(t.wsUrl);function n(e){var n=e.from,i=e.type,o=e.data;"ice-candidate"!==i?t.messageListener(n,i,o):t.peers[n].handleSignal(o)}e.on("connect",(function(){NAF.log.write("User connected",e.id),t.myId=e.id,t.joinRoom()})),e.on("connectSuccess",(function(e){var n=e.joinedTime;t.myRoomJoinTime=n,NAF.log.write("Successfully joined room",t.room,"at server time",n),t.sendAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){t.storeAudioStream(t.myId,e),t.connectSuccess(t.myId),e.getTracks().forEach((function(n){Object.keys(t.peers).forEach((function(i){t.peers[i].pc.addTrack(n,e)}))}))})).catch((function(e){NAF.log.error(e),console.error("Microphone is disabled due to lack of permissions"),t.sendAudio=!1,t.connectSuccess(t.myId)})):t.connectSuccess(t.myId)})),e.on("error",(function(e){console.error("Socket connection failure",e),t.connectFailure()})),e.on("occupantsChanged",(function(e){var n=e.occupants;NAF.log.write("occupants changed",e),t.receivedOccupants(n)})),e.on("send",n),e.on("broadcast",n)}))}},{key:"joinRoom",value:function(){NAF.log.write("Joining room",this.room),this.socket.emit("joinRoom",{room:this.room})}},{key:"receivedOccupants",value:function(t){var e=this;delete t[this.myId],this.occupants=t;var n=this,i=this.myId,o=function(){var t=r;if(e.peers[t])return 1;var o=new s(i,t,(function(e){n.socket.emit("send",{from:i,to:t,type:"ice-candidate",data:e,sending:!0})}));o.setDatachannelListeners(n.openListener,n.closedListener,n.messageListener,n.trackListener.bind(n)),n.peers[t]=o};for(var r in t)o();this.occupantListener(t)}},{key:"shouldStartConnectionTo",value:function(t){return(this.myRoomJoinTime||0)<=(t||0)}},{key:"startStreamConnection",value:function(t){var e=this;NAF.log.write("starting offer process"),this.sendAudio?this.getMediaStream(this.myId).then((function(n){var i={sendAudio:!0,localAudioStream:n};e.peers[t].offer(i)})):this.peers[t].offer({})}},{key:"closeStreamConnection",value:function(t){NAF.log.write("closeStreamConnection",t,this.peers),this.peers[t].close(),delete this.peers[t],delete this.occupants[t],this.closedListener(t)}},{key:"getConnectStatus",value:function(t){var e=this.peers[t];if(void 0===e)return NAF.adapters.NOT_CONNECTED;switch(e.getStatus()){case s.IS_CONNECTED:return NAF.adapters.IS_CONNECTED;case s.CONNECTING:return NAF.adapters.CONNECTING;case s.NOT_CONNECTED:default:return NAF.adapters.NOT_CONNECTED}}},{key:"sendData",value:function(t,e,n){this.peers[t].send(e,n)}},{key:"sendDataGuaranteed",value:function(t,e,n){var i={from:this.myId,to:t,type:e,data:n,sending:!0};this.socket.emit("send",i)}},{key:"broadcastData",value:function(t,e){for(var n in this.peers)this.sendData(n,t,e)}},{key:"broadcastDataGuaranteed",value:function(t,e){var n={from:this.myId,type:t,data:e,broadcasting:!0};this.socket.emit("broadcast",n)}},{key:"storeAudioStream",value:function(t,e){this.audioStreams[t]=e,this.pendingAudioRequest[t]&&(NAF.log.write("Received pending audio for "+t),this.pendingAudioRequest[t](e),this.pendingAudioRequest[t](e))}},{key:"trackListener",value:function(t,e){this.storeAudioStream(t,e)}},{key:"getMediaStream",value:function(t){var e=this;return this.audioStreams[t]?(NAF.log.write("Already had audio for "+t),Promise.resolve(this.audioStreams[t])):(NAF.log.write("Waiting on audio for "+t),new Promise((function(n){e.pendingAudioRequest[t]=n})))}},{key:"updateTimeOffset",value:function(){var t=this,e=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then((function(n){var i=new Date(n.headers.get("Date")).getTime()+500,o=Date.now(),r=i+(o-e)/2-o;t.serverTimeRequests++,t.serverTimeRequests<=10?t.timeOffsets.push(r):t.timeOffsets[t.serverTimeRequests%10]=r,t.avgTimeOffset=t.timeOffsets.reduce((function(t,e){return t+e}),0)/t.timeOffsets.length,t.serverTimeRequests>10?setTimeout((function(){return t.updateTimeOffset()}),3e5):t.updateTimeOffset()}))}},{key:"getServerTime",value:function(){return(new Date).getTime()+this.avgTimeOffset}}]),t}();t.exports=a},462:(t,e,n)=>{var i=n(520);AFRAME.registerComponent("networked-audio-source",{schema:{streamName:{default:"audio"},positional:{default:!0},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},maxDistance:{default:1e4},refDistance:{default:1},rolloffFactor:{default:1},createSoundOnInit:{default:!0}},init:function(){this.stream=null,this.sound=null,this.audioEl=null,this._setupSound=this._setupSound.bind(this),this.data.createSoundOnInit&&this.createSound()},update:function(t){this.sound&&(t.positional!==this.data.positional?(this.destroySound(),this._setupSound(this.stream)):this.data.positional&&this._setPannerProperties())},_setPannerProperties:function(){this.sound.setDistanceModel(this.data.distanceModel),this.sound.setMaxDistance(this.data.maxDistance),this.sound.setRefDistance(this.data.refDistance),this.sound.setRolloffFactor(this.data.rolloffFactor)},remove:function(){this.destroySound()},destroySound:function(){this.sound&&(this.el.emit("sound-source-removed",{soundSource:this.soundSource}),this.sound.disconnect(),this.el.removeObject3D(this.attrName),this.sound=null),this.audioEl&&(this.audioEl.pause(),this.audioEl.srcObject=null,this.audioEl.load(),this.audioEl=null)},createSound:function(){var t=this;NAF.utils.getNetworkedEntity(this.el).then((function(e){var n=e.components.networked.data.owner;n&&NAF.connection.adapter.getMediaStream(n,t.data.streamName).then(t._setupSound).catch((function(t){return i.log.error("Error getting media stream for ".concat(n),t)}))}))},_setupSound:function(t){if(t&&this.el.parentNode){var e=this.el,n=e.sceneEl;n.audioListener||(n.audioListener=new THREE.AudioListener,n.camera&&n.camera.add(n.audioListener),n.addEventListener("camera-set-active",(function(t){t.detail.cameraEl.getObject3D("camera").add(n.audioListener)}))),this.sound=this.data.positional?new THREE.PositionalAudio(n.audioListener):new THREE.Audio(n.audioListener),e.setObject3D(this.attrName,this.sound),this.data.positional&&this._setPannerProperties(),/chrome/i.test(navigator.userAgent)&&(this.audioEl=new Audio,this.audioEl.setAttribute("autoplay","autoplay"),this.audioEl.setAttribute("playsinline","playsinline"),this.audioEl.srcObject=t,this.audioEl.volume=0),this.soundSource=this.sound.context.createMediaStreamSource(t),this.sound.setNodeSource(this.soundSource),this.el.emit("sound-source-set",{soundSource:this.soundSource}),this.stream=t}}})},233:()=>{function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}["left","right"].forEach((function(t){var e=document.createElement("template"),n=document.createElement("a-entity");e.id="".concat(t,"-hand-default-template"),n.setAttribute("rotation","0 0 0"),n.setAttribute("networked-hand-controls","hand: ".concat(t)),e.appendChild(n);var i="#".concat(e.id);NAF.schemas.schemaDict[i]={template:i,components:[{component:"position",requiresNetworkUpdate:NAF.utils.vectorRequiresUpdate(.001)},{component:"rotation",requiresNetworkUpdate:NAF.utils.vectorRequiresUpdate(.5)},"networked-hand-controls"]},NAF.schemas.templateCache[i]=e})),AFRAME.registerComponent("networked-hand-controls",{schema:{color:{default:"white",type:"color"},hand:{type:"string",default:"left",oneOf:["right","left"]},handModelStyle:{type:"string",default:"highPoly",oneOf:["lowPoly","highPoly","toon","controller"]},controllerComponent:{type:"string",default:""},webxrControllerProfiles:{type:"string",default:""},controllerEvent:{default:JSON.stringify({}),type:"string"},controllerModelUpdate:{default:[],type:"array"},customHandModelURL:{type:"string",default:""},gesture:{type:"string",default:"open"},visible:{type:"bool",default:!1}},init:function(){var e=this;this.setup(),this.rendererSystem=this.el.sceneEl.systems.renderer,"controller"!==this.data.handModelStyle&&this.addHandModel(),NAF.utils.getNetworkedEntity(this.el).then((function(t){e.local=t.components.networked.createdByMe()})).catch((function(){e.local=!0})).then((function(){if(e.local){for(var n in e.addControllerComponents("controller"===e.data.handModelStyle),e.buttonEventMap){var i;e.eventFunctionMap[e.data.hand][n]=(i=e.handleButton).bind.apply(i,[e].concat(t(e.buttonEventMap[n])))}for(var o in e.visibleListeners)e.eventFunctionMap[e.data.hand][o]=e.visibleListeners[o].bind(e)}else e.el.classList.add("naf-remote-hand")}))},play:function(){this.local&&this.addEventListeners()},pause:function(){this.local&&this.removeEventListeners()},tick:function(t,e){var n;null!==(n=this.getMesh())&&void 0!==n&&n.mixer&&this.getMesh().mixer.update(e/1e3)},update:function(e){var n=this;if(e.visible!=this.data.visible&&(this.el.object3D.visible=this.data.visible),e.handModelStyle&&e.handModelStyle!==this.data.handModelStyle&&(this.getMesh()&&this.el.removeObject3D(this.str.mesh),["gltf-model","obj-model"].forEach((function(t){n.el.components[t]&&n.el.removeAttribute(t)})),"controller"!==this.data.handModelStyle?this.addHandModel():(this.data.controllerComponent&&this.el.components[this.data.controllerComponent]&&this.el.removeAttribute(this.data.controllerComponent),this.local?(this.addControllerComponents(!0),this.el.components[this.data.controllerComponent].injectTrackedControls({profiles:JSON.parse(this.data.webxrControllerProfiles)})):!this.injectedController&&this.data.controllerComponent&&this.data.webxrControllerProfiles[0]&&this.injectRemoteControllerModel())),e.color&&this.data.handModelStyle!==this.str.controller&&e.color!==this.data.color&&this.updateHandMeshColor(),!this.local)if(this.data.handModelStyle!==this.str.controller&&this.data.gesture!==e.gesture)this.handleGesture(this.data.gesture,e.gesture);else if(this.data.handModelStyle===this.str.controller){if(!this.injectedController&&this.data.controllerComponent&&this.data.webxrControllerProfiles[0]&&this.injectRemoteControllerModel(),e.controllerEvent&&e.controllerEvent!==this.data.controllerEvent){var i=JSON.parse(this.data.controllerEvent);this.el.components[this.data.controllerComponent]["thumbstickmoved"===i.type?"onThumbstickMoved":"onButtonChanged"](i)}var o;!e.controllerModelUpdate||e.controllerModelUpdate[0]===this.data.controllerModelUpdate[0]&&e.controllerModelUpdate[1]===this.data.controllerModelUpdate[1]||(o=this.el.components[this.data.controllerComponent]).updateModel.apply(o,t(this.data.controllerModelUpdate))}},remove:function(){this.el.removeObject3D(this.str.mesh)},addHandModel:function(){var t=this;this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("anonymous");var e=this.MODEL_BASE+this.MODEL_NAMES[this.data.handModelStyle+this.data.hand.charAt(0).toUpperCase()+this.data.hand.slice(1)];this.loader.load(this.data.customHandModelURL||e,(function(e){var n=e.scene.children[0],i="left"===t.data.hand?Math.PI/2:-Math.PI/2;n.mixer=new THREE.AnimationMixer(n),t.clips=e.animations,t.clips.forEach((function(e){t.clipNameToClip[e.name]=e})),t.el.setObject3D(t.str.mesh,n);var o=n.children[1].material;o.color=new THREE.Color(t.data.color),t.rendererSystem.applyColorCorrection(o.color),n.position.set(0,0,0),n.rotation.set(0,0,i)}))},updateHandMeshColor:function(){var t=this.getMesh();if(t){var e=t.children[1].material;e.color.set(this.data.color),this.rendererSystem.applyColorCorrection(e.color)}},controllerComponents:["magicleap-controls","vive-controls","oculus-touch-controls","windows-motion-controls","hp-mixed-reality-controls","valve-index-controls","oculus-go-controls","gearvr-controls","daydream-controls","vive-focus-controls"],addControllerComponents:function(t){var e=this;this.controllerComponents.forEach((function(n){e.data.controllerComponent&&e.data.controllerComponent!==n||(e.el.setAttribute(n,{hand:e.data.hand,model:t}),e.el.components[n].injectTrackedControls=e.injectControlsWrapper.bind(e,e.el.components[n].injectTrackedControls.bind(e.el.components[n]),n))})),this.isViveController()},injectControlsWrapper:function(t,e,n){this.el.setAttribute("networked-hand-controls",{controllerComponent:e,webxrControllerProfiles:JSON.stringify(n.profiles)}),t(n),this.el.components[e].updateModel=this.updateModelWrapper.bind(this,this.el.components[e].updateModel.bind(this.el.components[e])),this.el.components[e].onButtonChanged=this.onButtonChangedWrapper.bind(this,this.el.components[e].onButtonChanged),this.el.components[e].onThumbstickMoved=this.onThumbstickMovedWrapper.bind(this,this.el.components[e].onThumbstickMoved),this.el.components[e].removeEventListeners(),this.el.components[e].addEventListeners()},onButtonChangedWrapper:function(t,e){this.el.setAttribute("networked-hand-controls",this.str.controllerEvent,JSON.stringify({detail:e.detail,type:e.type})),t(e)},onThumbstickMovedWrapper:function(t,e){this.el.setAttribute("networked-hand-controls",this.str.controllerEvent,JSON.stringify({detail:e.detail,type:e.type})),t(e)},updateModelWrapper:function(t,e,n){this.btnEvtMap[e]||(this.btnEvtMap[e]={}),this.btnEvtMap[e][n]||(this.btnEvtMap[e][n]="".concat(e,",").concat(n)),this.el.setAttribute("networked-hand-controls","controllerModelUpdate",this.btnEvtMap[e][n]),t(e,n)},catchPoseTrackingInitialization:function(){this.catchAndRemoveWebXRTracking=function(t){"tracked-controls-webxr"===t.detail.name&&(this.el.removeEventListener("componentinitialized",this.catchAndRemoveWebXRTracking),this.el.removeAttribute("tracked-controls-webxr"))}.bind(this),this.el.addEventListener("componentinitialized",this.catchAndRemoveWebXRTracking)},injectRemoteControllerModel:function(){this.el.pause(),this.el.setAttribute(this.data.controllerComponent,{hand:this.data.hand,model:!0}),this.el.components[this.data.controllerComponent].removeControllersUpdateListener(),this.el.components[this.data.controllerComponent].checkIfControllerPresent&&this.el.components[this.data.controllerComponent].loadModel?(this.el.components[this.data.controllerComponent].checkIfControllerPresent=function(t){return t},this.el.components[this.data.controllerComponent].injectTrackedControls=function(t){return t},this.el.addEventListener("model-loaded",this.el.components[this.data.controllerComponent].onModelLoaded),this.el.components[this.data.controllerComponent].loadModel({profiles:JSON.parse(this.data.webxrControllerProfiles)})):(console.warn("fallback path: will add and then disable pose tracking",this.data.controllerComponent,this.el,this.el.components),this.el.addEventListener("model-loaded",this.el.components[this.data.controllerComponent].onModelLoaded),this.catchPoseTrackingInitialization(),this.el.components[this.data.controllerComponent].injectTrackedControls({profiles:JSON.parse(this.data.webxrControllerProfiles)})),this.el.play(),this.injectedController=!0},getMesh:function(){return this.el.getObject3D(this.str.mesh)},local:!1,eventFunctionMap:{left:{},right:{}},buttonEventMap:{gripdown:["grip","down"],gripup:["grip","up"],trackpaddown:["trackpad","down"],trackpadup:["trackpad","up"],trackpadtouchstart:["trackpad","touchstart"],trackpadtouchend:["trackpad","touchend"],triggerdown:["trigger","down"],triggerup:["trigger","up"],triggertouchstart:["trigger","touchstart"],triggertouchend:["trigger","touchend"],griptouchstart:["grip","touchstart"],griptouchend:["grip","touchend"],abuttontouchstart:["AorX","touchstart"],abuttontouchend:["AorX","touchend"],bbuttontouchstart:["BorY","touchstart"],bbuttontouchend:["BorY","touchend"],xbuttontouchstart:["AorX","touchstart"],xbuttontouchend:["AorX","touchend"],ybuttontouchstart:["BorY","touchstart"],ybuttontouchend:["BorY","touchend"],surfacetouchstart:["surface","touchstart"],surfacetouchend:["surface","touchend"]},visibleListeners:{controllerconnected:function(){this.el.setAttribute("networked-hand-controls","visible",!0)},controllerdisconnected:function(){this.el.setAttribute("networked-hand-controls","visible",!1)}},addEventListeners:function(){for(var t in this.buttonEventMap)this.el.addEventListener(t,this.eventFunctionMap[this.data.hand][t]);for(var e in this.visibleListeners)this.el.addEventListener(e,this.eventFunctionMap[this.data.hand][e])},removeEventListeners:function(){for(var t in this.buttonEventMap)this.el.removeEventListener(t,this.eventFunctionMap[this.data.hand][t]);for(var e in this.visibleListeners)this.el.removeEventListener(e,this.eventFunctionMap[this.data.hand][e])},str:{nafHandControls:"networked-hand-controls",mesh:"mesh",gesture:"gesture",down:"down",touchstart:"touchstart",fist:"fist",point:"point",thumbUp:"thumbUp",pistol:"pistol",hold:"hold",open:"open",controller:"controller",controllerEvent:"controllerEvent"},handleButton:function(t,e){"controller"!==this.data.handModelStyle&&(this.isContact=e===this.str.down||e===this.str.touchstart,this.isContact!==this.contact[t]&&(this.contact[t]=this.isContact,this.lastGesture=this.data.gesture,this.determineGesture(),this.gesture!==this.lastGesture&&(this.el.setAttribute(this.str.nafHandControls,this.str.gesture,this.gesture),this.handleGesture())))},handleGesture:function(){this.data.gesture!==this.lastGesture&&(this.playAnimation(),this.emitGestureEvents())},determineGesture:function(){this.gripIsActive=this.contact.grip,this.triggerIsActive=this.contact.trigger,this.thumbIsActive=this.contact.trackpad||this.contact.surface,this.contact.AorX||this.contact.BorY,this.isVive?this.gesture=this.gripIsActive||this.triggerIsActive?this.str.fist:this.contact.trackpad?this.str.point:this.str.open:this.gesture=this.gripIsActive&&this.thumbIsActive&&this.triggerIsActive?this.str.fist:this.gripIsActive&&this.thumbIsActive&&!this.triggerIsActive?this.str.point:this.gripIsActive&&!this.thumbIsActive&&this.triggerIsActive?this.str.thumbUp:!this.gripIsActive||this.thumbIsActive||this.triggerIsActive?this.triggerIsActive?this.str.hold:this.str.open:this.str.pistol},emitGestureEvents:function(){var t,e;this.el.emit(null===(t=this.eventNames[this.lastGesture])||void 0===t?void 0:t.inactive),this.el.emit(null===(e=this.eventNames[this.data.gesture])||void 0===e?void 0:e.active)},eventNames:{fist:{active:"fiststart",inactive:"fistend"},thumbUp:{active:"thumbupstart",inactive:"thumbupend"},point:{active:"pointstart",inactive:"pointend"},hold:{active:"holdstart",inactive:"holdend"},open:{active:"openstart",inactive:"openend"},pistol:{active:"pistolstart",inactive:"pistolend"}},playAnimation:function(){if(this.getMesh()){if(this.getMesh().mixer.stopAllAction(),this.clip=this.clipNameToClip[this.ANIMATIONS[this.data.gesture]],this.toAction=this.getMesh().mixer.clipAction(this.clip),this.toAction.clampWhenFinished=!0,this.toAction.loop=THREE.LoopRepeat,this.toAction.repetitions=0,this.toAction.timeScale=this.reverse?-1:1,this.toAction.time=this.reverse?this.clip.duration:0,this.toAction.weight=1,!this.lastGesture||this.data.gesture===this.lastGesture)return this.getMesh().mixer.stopAllAction(),void this.toAction.play();this.clip=this.clipNameToClip[this.ANIMATIONS[this.lastGesture]],this.fromAction=this.getMesh().mixer.clipAction(this.clip),this.fromAction.weight=.15,this.fromAction.play(),this.toAction.play(),this.fromAction.crossFadeTo(this.toAction,.15,!0)}},MODEL_BASE:"https://cdn.aframe.io/controllers/hands/",MODEL_NAMES:{toonLeft:"leftHand.glb",toonRight:"rightHand.glb",lowPolyLeft:"leftHandLow.glb",lowPolyRight:"rightHandLow.glb",highPolyLeft:"leftHandHigh.glb",highPolyRight:"rightHandHigh.glb"},clipNameToClip:{},ANIMATIONS:{open:"Open",point:"Point",pistol:"Point + Thumb",fist:"Fist",hold:"Hold",thumbUp:"Thumb Up"},isVive:!1,isViveController:function(){var t=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller;this.isVive=t&&(t.id&&0===t.id.indexOf("OpenVR ")||t.profiles&&t.profiles[0]&&"htc-vive"===t.profiles[0])},btnEvtMap:{},setup:function(){this.contact={grip:!1,trigger:!1,surface:!1,trackpad:!1,AorX:!1,BorY:!1},this.reverse=!1,this.isContact=!1,this.injectedController=!1,this.lastGesture="",this.gesture="",this.gripIsActive=!1,this.triggerIsActive=!1,this.thumbIsActive=!1,this.clip=null,this.toAction=null,this.fromAction=null}})},244:()=>{AFRAME.registerComponent("networked-scene",{schema:{serverURL:{default:"/"},app:{default:"default"},room:{default:"default"},connectOnLoad:{default:!0},onConnect:{default:"onConnect"},adapter:{default:"wseasyrtc"},audio:{default:!1},video:{default:!1},debug:{default:!1}},init:function(){var t=this.el;this.connect=this.connect.bind(this),t.addEventListener("connect",this.connect),this.data.connectOnLoad&&t.emit("connect",null,!1)},connect:function(){return NAF.log.setDebug(this.data.debug),NAF.log.write("Networked-Aframe Connecting..."),this.checkDeprecatedProperties(),this.setupNetworkAdapter(),this.hasOnConnectFunction()&&this.callOnConnect(),NAF.connection.connect(this.data.serverURL,this.data.app,this.data.room,this.data.audio,this.data.video)},checkDeprecatedProperties:function(){},setupNetworkAdapter:function(){var t=this.data.adapter,e=NAF.adapters.make(t);NAF.connection.setNetworkAdapter(e),this.el.emit("adapter-ready",e,!1)},hasOnConnectFunction:function(){return""!=this.data.onConnect&&window[this.data.onConnect]},callOnConnect:function(){NAF.connection.onConnect(window[this.data.onConnect])},remove:function(){NAF.log.write("networked-scene disconnected"),this.el.removeEventListener("connect",this.connect),NAF.connection.disconnect()}})},165:(t,e,n)=>{var i=n(520);AFRAME.registerComponent("networked-video-source",{schema:{streamName:{default:"video"}},dependencies:["material"],init:function(){this.videoTexture=null,this.video=null,this.stream=null,this._setMediaStream=this._setMediaStream.bind(this),this._waitForMediaStream=this._waitForMediaStream.bind(this),this._waitForMediaStream()},_waitForMediaStream:function(){var t=this;NAF.utils.getNetworkedEntity(this.el).then((function(e){var n=e.components.networked.data.owner;n&&NAF.connection.adapter.getMediaStream(n,t.data.streamName).then(t._setMediaStream).catch((function(t){return i.log.error("Error getting media stream for ".concat(n),t)}))}))},_setMediaStream:function(t){var e=this;if(this.video||this.setupVideo(),t!==this.stream){if(this.stream&&this._clearMediaStream(),t){this.video.srcObject=t;var n=this.video.play();n instanceof Promise&&n.catch((function(t){return i.log.error("Error play video stream",t)})),this.videoTexture&&this.videoTexture.dispose(),this.videoTexture=new THREE.VideoTexture(this.video);var o=this.el.getObject3D("mesh");o.material.map=this.videoTexture,o.material.map.colorSpace=THREE.SRGBColorSpace,o.material.needsUpdate=!0,t.addEventListener("removetrack",(function(){e._clearMediaStream(),e._waitForMediaStream()}))}this.stream=t}},_clearMediaStream:function(){if(this.stream=null,this.videoTexture){if(this.videoTexture.image instanceof HTMLVideoElement){var t=this.videoTexture.image;t.pause(),t.srcObject=null,t.load()}this.videoTexture.dispose(),this.videoTexture=null;var e=this.el.getObject3D("mesh");e.material.map=null,e.material.needsUpdate=!0}},remove:function(){this._clearMediaStream()},setupVideo:function(){if(!this.video){var t=document.createElement("video");t.setAttribute("autoplay",!0),t.setAttribute("playsinline",!0),t.setAttribute("muted",!0),this.video=t}}})},162:(t,e,n)=>{var i=n(447),o=n(80),r=THREE.MathUtils.DEG2RAD,s=["position","rotation","scale"];function a(t){return!(!t.isVector3||isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||null===t.x||null===t.y||null===t.z)}var c,u=(c=0,function(t,e){var n=Date.now();n-c>e&&(c=n,t())});function l(){NAF.log.warn("Received invalid network update.")}AFRAME.registerSystem("networked",{init:function(){this.components=[],this.nextSyncTime=0},register:function(t){this.components.push(t)},deregister:function(t){var e=this.components.indexOf(t);e>-1&&this.components.splice(e,1)},tick:function(){if(NAF.connection.adapter&&!(this.el.clock.elapsedTime<this.nextSyncTime)){for(var t={d:[]},e=0,n=this.components.length;e<n;e++){var i=this.components[e];if(i.isMine()){if(!i.el.parentElement)return void NAF.log.error("entity registered with system despite being removed");var o=this.components[e].syncDirty();o&&t.d.push(o)}}t.d.length>0&&NAF.connection.broadcastData("um",t),this.updateNextSyncTime()}},updateNextSyncTime:function(){this.nextSyncTime=this.el.clock.elapsedTime+1/NAF.options.updateRate}}),AFRAME.registerComponent("networked",{schema:{template:{default:""},attachTemplateToLocal:{default:!0},persistent:{default:!1},networkId:{default:""},owner:{default:""},creator:{default:""}},init:function(){this.OWNERSHIP_GAINED="ownership-gained",this.OWNERSHIP_CHANGED="ownership-changed",this.OWNERSHIP_LOST="ownership-lost",this.onOwnershipGainedEvent={el:this.el},this.onOwnershipChangedEvent={el:this.el},this.onOwnershipLostEvent={el:this.el},this.conversionEuler=new THREE.Euler,this.conversionEuler.order="YXZ",this.bufferInfos=[],this.bufferPosition=new THREE.Vector3,this.bufferQuaternion=new THREE.Quaternion,this.bufferScale=new THREE.Vector3;var t,e=this.wasCreatedByNetwork();this.onConnected=this.onConnected.bind(this),this.syncData={},this.componentSchemas=NAF.schemas.getComponents(this.data.template),this.cachedElements=new Array(this.componentSchemas.length),this.networkUpdatePredicates=this.componentSchemas.map((function(t){return t.requiresNetworkUpdate&&t.requiresNetworkUpdate()||(e=null,function(t){return!(null!==e&&i(e,t)||(e=AFRAME.utils.clone(t),0))});var e})),this.invalidateCachedElements(),this.initNetworkParent(),""===this.data.networkId?(t=NAF.utils.createNetworkId(),this.el.setAttribute(this.name,{networkId:t})):t=this.data.networkId,this.el.id||this.el.setAttribute("id","naf-"+t),e?this.firstUpdate():(this.data.attachTemplateToLocal&&this.attachTemplateToLocal(),this.registerEntity(this.data.networkId)),this.lastOwnerTime=-1,NAF.clientId?this.onConnected():document.body.addEventListener("connected",this.onConnected,!1),document.body.dispatchEvent(this.entityCreatedEvent()),this.el.dispatchEvent(new CustomEvent("instantiated",{detail:{el:this.el}})),this.el.sceneEl.systems.networked.register(this)},attachTemplateToLocal:function(){for(var t=NAF.schemas.getCachedTemplate(this.data.template),e=t.attributes,n=0;n<e.length;n++)this.el.setAttribute(e[n].name,e[n].value);for(;t.firstElementChild;)this.el.appendChild(t.firstElementChild)},takeOwnership:function(){var t=this.data.owner,e=this.lastOwnerTime,n=NAF.connection.getServerTime();return!!(t&&!this.isMine()&&e<n)&&(this.lastOwnerTime=n,this.removeLerp(),this.el.setAttribute("networked",{owner:NAF.clientId}),this.syncAll(),this.onOwnershipGainedEvent.oldOwner=t,this.el.emit(this.OWNERSHIP_GAINED,this.onOwnershipGainedEvent),this.onOwnershipChangedEvent.oldOwner=t,this.onOwnershipChangedEvent.newOwner=NAF.clientId,this.el.emit(this.OWNERSHIP_CHANGED,this.onOwnershipChangedEvent),!0)},wasCreatedByNetwork:function(){return!!this.el.firstUpdateData},initNetworkParent:function(){var t=this.el.parentElement;t.components&&t.components.networked?this.parent=t:this.parent=null},registerEntity:function(t){NAF.entities.registerEntity(t,this.el)},applyPersistentFirstSync:function(){var t=this.data.networkId,e=NAF.entities.getPersistentFirstSync(t);e&&(this.networkUpdate(e),NAF.entities.forgetPersistentFirstSync(t))},firstUpdate:function(){var t=this.el.firstUpdateData;this.networkUpdate(t)},onConnected:function(){var t=this;""===this.data.owner&&(this.lastOwnerTime=NAF.connection.getServerTime(),this.el.setAttribute(this.name,{owner:NAF.clientId,creator:NAF.clientId}),setTimeout((function(){t.el.parentNode?t.syncAll(void 0,!0):NAF.log.warn("Networked element was removed before ever getting the chance to syncAll")}),0)),document.body.removeEventListener("connected",this.onConnected,!1)},isMine:function(){return this.data.owner===NAF.clientId},createdByMe:function(){return this.data.creator===NAF.clientId},tick:function(t,e){if(!this.isMine()&&NAF.options.useLerp)for(var n=0;n<this.bufferInfos.length;n++){var i=this.bufferInfos[n],o=i.buffer,r=i.object3D,s=i.componentNames;if(o.update(e),s.includes("position")){var c=o.getPosition();a(c)?r.position.copy(c):u(l,5e3)}if(s.includes("rotation")){var h=o.getQuaternion();!(f=h).isQuaternion||isNaN(f.x)||isNaN(f.y)||isNaN(f.z)||isNaN(f.w)||null===f.x||null===f.y||null===f.z||null===f.w?u(l,5e3):r.quaternion.copy(h)}if(s.includes("scale")){var d=o.getScale();a(d)?r.scale.copy(d):u(l,5e3)}}var f},syncAll:function(t,e){if(this.canSync()){var n=this.gatherComponentsData(!0),i=this.createSyncData(n,e);t?NAF.connection.sendDataGuaranteed(t,"u",i):NAF.connection.broadcastDataGuaranteed("u",i)}},syncDirty:function(){if(this.canSync()){var t=this.gatherComponentsData(!1);if(null!==t)return this.createSyncData(t)}},getCachedElement:function(t){var e=this.cachedElements[t];if(e)return e;var n=this.componentSchemas[t];return n.selector?this.cachedElements[t]=this.el.querySelector(n.selector):this.cachedElements[t]=this.el},invalidateCachedElements:function(){for(var t=0;t<this.cachedElements.length;t++)this.cachedElements[t]=null},gatherComponentsData:function(t){for(var e=null,n=0;n<this.componentSchemas.length;n++){var i=this.componentSchemas[n],o=this.getCachedElement(n);if(o){var r=i.component?i.component:i,s=o.getAttribute(r);if(null!==s){var a=i.property?s[i.property]:s;(this.networkUpdatePredicates[n](a)||t)&&((e=e||{})[n]=a)}else t&&((e=e||{})[n]=null)}else t&&((e=e||{})[n]=null)}return e},createSyncData:function(t,e){var n=this.syncData,i=this.data;return n.networkId=i.networkId,n.owner=i.owner,n.creator=i.creator,n.lastOwnerTime=this.lastOwnerTime,n.template=i.template,n.persistent=i.persistent,n.parent=this.getParentId(),n.components=t,n.isFirstSync=!!e,n},canSync:function(){if(this.data.owner&&this.isMine())return!0;if(!this.createdByMe())return!1;var t=NAF.connection.getConnectedClients();for(var e in t)if(e===this.data.owner)return!1;return!0},getParentId:function(){return this.initNetworkParent(),this.parent?this.parent.getAttribute("networked").networkId:null},networkUpdate:function(t){if(!(t.lastOwnerTime<this.lastOwnerTime||this.lastOwnerTime===t.lastOwnerTime&&this.data.owner>t.owner)&&void 0!==this.data){if(this.data.owner!==t.owner){var e=this.isMine();this.lastOwnerTime=t.lastOwnerTime;var n=this.data.owner,i=t.owner;this.el.setAttribute("networked",{owner:t.owner}),e&&(this.onOwnershipLostEvent.newOwner=i,this.el.emit(this.OWNERSHIP_LOST,this.onOwnershipLostEvent)),this.onOwnershipChangedEvent.oldOwner=n,this.onOwnershipChangedEvent.newOwner=i,this.el.emit(this.OWNERSHIP_CHANGED,this.onOwnershipChangedEvent)}this.data.persistent!==t.persistent&&this.el.setAttribute("networked",{persistent:t.persistent}),this.updateNetworkedComponents(t.components)}},updateNetworkedComponents:function(t){for(var e=0,n=this.componentSchemas.length;e<n;e++){var i=t[e],o=this.componentSchemas[e],r=this.getCachedElement(e);null!==r&&null!=i&&(o.component?o.property?this.updateNetworkedComponent(r,o.component,o.property,i):this.updateNetworkedComponent(r,o.component,i):this.updateNetworkedComponent(r,o,i))}},updateNetworkedComponent:function(t,e,n,i){if(NAF.options.useLerp&&s.includes(e)){for(var a,c=0,u=this.bufferInfos.length;c<u;c++){var l=this.bufferInfos[c];if(l.object3D===t.object3D){a=l;break}}if(a){var h=a.componentNames;h.includes(e)||h.push(e)}else a={buffer:new o(o.MODE_LERP,.1),object3D:t.object3D,componentNames:[e]},this.bufferInfos.push(a);var d=a.buffer;switch(e){case"position":return void d.setPosition(this.bufferPosition.set(n.x,n.y,n.z));case"rotation":return this.conversionEuler.set(r*n.x,r*n.y,r*n.z),void d.setQuaternion(this.bufferQuaternion.setFromEuler(this.conversionEuler));case"scale":return void d.setScale(this.bufferScale.set(n.x,n.y,n.z))}NAF.log.error("Could not set value in interpolation buffer.",t,e,n,a)}else void 0===i?t.setAttribute(e,n):t.setAttribute(e,n,i)},removeLerp:function(){this.bufferInfos=[]},remove:function(){if(this.isMine()&&NAF.connection.isConnected()){var t={networkId:this.data.networkId};NAF.entities.hasEntity(this.data.networkId)?NAF.connection.broadcastDataGuaranteed("r",t):this.data.creator&&!1===NAF.connection.activeDataChannels[this.data.creator]||NAF.log.error("Removing networked entity that is not in entities array.")}NAF.entities.forgetEntity(this.data.networkId),document.body.dispatchEvent(this.entityRemovedEvent(this.data.networkId)),this.el.sceneEl.systems.networked.deregister(this)},entityCreatedEvent:function(){return new CustomEvent("entityCreated",{detail:{el:this.el}})},entityRemovedEvent:function(t){return new CustomEvent("entityRemoved",{detail:{networkId:t}})}})},998:t=>{t.exports={debug:!1,updateRate:15,useLerp:!0,firstSyncSource:null,syncSource:null}},648:t=>{t.exports.whenEntityLoaded=function(t,e){t.hasLoaded&&e(),t.addEventListener("loaded",(function(){e()}))},t.exports.createHtmlNodeFromString=function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild},t.exports.getCreator=function(t){var e=t.components;return e.networked?e.networked.data.creator:null},t.exports.getNetworkOwner=function(t){var e=t.components;return e.networked?e.networked.data.owner:null},t.exports.getNetworkId=function(t){var e=t.components;return e.networked?e.networked.data.networkId:null},t.exports.now=function(){return Date.now()},t.exports.createNetworkId=function(){return Math.random().toString(36).substring(2,9)},t.exports.getNetworkedEntity=function(t){return new Promise((function(e,n){for(var i=t;i&&i.components&&!i.components.networked;)i=i.parentNode;if(!i||!i.components||!i.components.networked)return n("Entity does not have and is not a child of an entity with the [networked] component ");i.hasLoaded?e(i):i.addEventListener("instantiated",(function(){e(i)}),{once:!0})}))},t.exports.takeOwnership=function(t){for(var e=t;e&&e.components&&!e.components.networked;)e=e.parentNode;if(!e||!e.components||!e.components.networked)throw new Error("Entity does not have and is not a child of an entity with the [networked] component ");return e.components.networked.takeOwnership()},t.exports.isMine=function(t){for(var e=t;e&&e.components&&!e.components.networked;)e=e.parentNode;if(!e||!e.components||!e.components.networked)throw new Error("Entity does not have and is not a child of an entity with the [networked] component ");return!!e.components.networked.data&&e.components.networked.data.owner===NAF.clientId},t.exports.almostEqualVec3=function(t,e,n){return Math.abs(t.x-e.x)<n&&Math.abs(t.y-e.y)<n&&Math.abs(t.z-e.z)<n},t.exports.vectorRequiresUpdate=function(t){return function(){var e=null;return function(n){return null===e?(e=new THREE.Vector3(n.x,n.y,n.z),!0):!NAF.utils.almostEqualVec3(e,n,t)&&(e.copy(n),!0)}}}}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n(520),n(244),n(162),n(462),n(165),n(233)})();